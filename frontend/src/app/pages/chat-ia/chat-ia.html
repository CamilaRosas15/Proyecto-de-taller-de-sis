<div class="app-container">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="logo">
      <img src="assets/logo.png" alt="Logo" class="logo-img">
      <h2>Nutrichef IA</h2>
    </div>

    <nav class="menu">
      <button class="menu-btn" routerLink="/principal">ğŸ  Inicio</button>
      <button class="menu-btn" routerLink="/recetas">ğŸ“– Recetas</button>
      <button class="menu-btn active">ğŸ’¬ Chat IA</button>
      <button class="menu-btn" routerLink="/analisis-imagen">ğŸ“¸ Analizar Imagen</button>
      
      <div class="historial">
        <h4>Historial de Recetas</h4>
        <button 
          *ngFor="let item of historialRecetas" 
          class="historial-btn"
          (click)="onCargarRecetaDelHistorial(item)">
          {{ item.receta?.nombre || 'Receta ' + item.id_receta }}
        </button>
        
        <div *ngIf="historialRecetas.length === 0" class="no-historial">
          <p>No hay recetas guardadas</p>
        </div>
      </div>
    </nav>

    <div class="user-info">
      <img src="assets/user.png" alt="Usuario" class="avatar">
      <div>
        <p class="username">Usuario</p>
        <p class="user-handle">@nutrichef</p>
      </div>
    </div>
  </aside>

  <!-- Main content -->
  <main class="main-content">
    <!-- Header -->
    <header class="header">
      <h1>{{ recetaSeleccionada ? recetaSeleccionada.titulo : 'PEDIR UNA RECETA' }}</h1>
      <div class="header-actions">
        <button *ngIf="recetaSeleccionada" (click)="volverAlChat()" class="back-btn">
          â† Volver al chat
        </button>
        <button class="progress-btn">â°</button>
      </div>
    </header>

    <!-- Chat Container -->
    <div class="chat-container">
      <!-- MODO RECETA COMPLETA -->
      <div *ngIf="recetaSeleccionada" class="recipe-full-view">
        <div class="recipe-full-card">
          <!-- Header -->
          <div class="recipe-full-header">
            <h2 class="recipe-full-title">{{ recetaSeleccionada.titulo }}</h2>
            <div class="recipe-full-meta">
              <span class="meta-badge">{{ recetaSeleccionada.categoria }}</span>
              <span class="meta-badge">â±ï¸ {{ recetaSeleccionada.tiempo_preparacion }} min</span>
              <span class="meta-badge">ğŸ”¥ {{ recetaSeleccionada.kcal_totales }} kcal</span>
            </div>
          </div>

          <!-- DescripciÃ³n -->
          <div class="recipe-full-description">
            <p>{{ recetaSeleccionada.descripcion }}</p>
          </div>

          <!-- Ingredientes -->
          <div class="recipe-full-section">
            <h3>ğŸ´ Ingredientes</h3>
            <div class="ingredients-grid-full">
              <div *ngFor="let ing of recetaSeleccionada.ingredientes" class="ingredient-full">
                <span class="ingredient-name">{{ ing.nombre }}</span>
                <span *ngIf="ing.cantidad" class="ingredient-quantity">
                  {{ ing.cantidad }} {{ ing.unidad || 'unidades' }}
                </span>
              </div>
            </div>
          </div>

          <!-- PreparaciÃ³n -->
          <div class="recipe-full-section">
            <h3>ğŸ‘©â€ğŸ³ PreparaciÃ³n</h3>
            <ol class="steps-full">
              <li *ngFor="let paso of recetaSeleccionada.pasos" class="step-full">
                {{ paso }}
              </li>
            </ol>
          </div>

          <!-- ExplicaciÃ³n IA -->
          <div *ngIf="recetaSeleccionada.ia_explicacion" class="ia-full">
            <h3>ğŸ¤– Por quÃ© esta receta es para ti</h3>
            <div class="ia-full-content">
              {{ recetaSeleccionada.ia_explicacion }}
            </div>
          </div>
        </div>
      </div>

      <!-- MODO CHAT NORMAL (cuando no hay receta seleccionada) -->
      <div *ngIf="!recetaSeleccionada">
        <!-- SecciÃ³n de entrada del usuario -->
        <div class="input-section">
          <h2>Â¿QuÃ© te gustarÃ­a cocinar?</h2>
          <div class="input-container">
            <input 
              type="text" 
              [(ngModel)]="userMessage" 
              placeholder="Escribe tus preferencias aquÃ­..."
              class="message-input"
              (keyup.enter)="sendMessage()">
            <button (click)="sendMessage()" class="send-btn">Generar recomendaciones</button>
          </div>
        </div>

        <!-- Loading -->
        <div *ngIf="cargando" class="loading-section">
          <div class="spinner"></div>
          <p>Generando recomendaciones personalizadas...</p>
        </div>

        <!-- Resultados de recetas -->
        <div *ngIf="opcionesRecetas.length > 0" class="recipes-section">
          <h3>Recomendaciones generadas:</h3>
          
          <div class="recipes-full-grid">
            <div *ngFor="let receta of opcionesRecetas" class="recipe-full-card">
              <!-- Header -->
              <div class="recipe-full-header">
                <h2 class="recipe-full-title">{{ receta.titulo }}</h2>
                <div class="recipe-full-meta">
                  <span class="meta-badge">{{ receta.categoria }}</span>
                  <span class="meta-badge">â±ï¸ {{ receta.tiempo_preparacion }} min</span>
                  <span class="meta-badge">ğŸ”¥ {{ receta.kcal_totales }} kcal</span>
                </div>
              </div>

              <!-- DescripciÃ³n -->
              <div class="recipe-full-description">
                <p>{{ receta.descripcion }}</p>
              </div>

              <!-- Ingredientes -->
              <div class="recipe-full-section">
                <h3>ğŸ´ Ingredientes</h3>
                <div class="ingredients-grid-full">
                  <div *ngFor="let ing of receta.ingredientes" class="ingredient-full">
                    <span class="ingredient-name">{{ ing.nombre }}</span>
                    <span *ngIf="ing.cantidad" class="ingredient-quantity">
                      {{ ing.cantidad }} {{ ing.unidad || 'unidades' }}
                    </span>
                  </div>
                </div>
              </div>

              <!-- PreparaciÃ³n -->
              <div class="recipe-full-section">
                <h3>ğŸ‘©â€ğŸ³ PreparaciÃ³n</h3>
                <ol class="steps-full">
                  <li *ngFor="let paso of receta.pasos" class="step-full">
                    {{ paso }}
                  </li>
                </ol>
              </div>

              <!-- ExplicaciÃ³n IA -->
              <div *ngIf="receta.ia_explicacion" class="ia-full">
                <h3>ğŸ¤– Por quÃ© esta receta es para ti</h3>
                <div class="ia-full-content">
                  {{ receta.ia_explicacion }}
                </div>
              </div>

              <!-- BotÃ³n de acciÃ³n -->
              <div class="recipe-full-actions">
                <button 
                  class="select-recipe-btn-full"
                  (click)="onSeleccionarReceta(receta)">
                  ğŸ’– Prefiero esta receta
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Error -->
        <div *ngIf="errorMessage" class="error-message">
          <p>âŒ {{ errorMessage }}</p>
        </div>
      </div>
    </div>
  </main>
</div>