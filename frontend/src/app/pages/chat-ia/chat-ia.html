<div class="app-container">
  <!-- Header ahora con el logo Y el botÃ³n hamburguesa -->
  <header class="header">
    <div class="header-logo">
      <img src="assets/logo.png" alt="Logo" class="logo-img">
      <h2>Nutrichef IA</h2>
    </div>
    
    <!-- BotÃ³n Hamburguesa para Mobile - AHORA EN EL HEADER -->
    <button class="menu-mobile-toggle" (click)="toggleMobileMenu()" [class.active]="isMobileMenuOpen">
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
    </button>

    <div class="header-actions">
      <button *ngIf="recetaSeleccionada" (click)="volverAlChat()" class="back-btn">
        â† Volver al chat
      </button>
    </div>
  </header>

  <div class="content-wrapper">
    <!-- Sidebar para Desktop - SIN el botÃ³n hamburguesa -->
    <aside class="sidebar">
      <!-- EL BOTÃ“N HAMBURGUESA FUE MOVIDO AL HEADER -->

      <nav class="menu">
        <button class="menu-btn" routerLink="/principal">ğŸ  Inicio</button>
        <button class="menu-btn" routerLink="/recetas">ğŸ“– Recetas</button>
        <button class="menu-btn active">ğŸ’¬ Chat IA</button>
        <button class="menu-btn" routerLink="/analisis-imagen">ğŸ“¸ Analizar Imagen</button>
        <!-- ğŸ”¥ NUEVO: BotÃ³n Mi Progreso agregado al menÃº -->
        <button class="menu-btn" routerLink="/progreso">ğŸ“Š Mi Progreso</button>
        
        <div class="historial">
          <h4>Historial de Recetas</h4>
          <button 
            *ngFor="let item of historialRecetas" 
            class="historial-btn"
            (click)="onCargarRecetaDelHistorial(item)">
            {{ item.receta?.nombre || 'Receta ' + item.id_receta }}
          </button>
          
          <div *ngIf="historialRecetas.length === 0" class="no-historial">
            <p>No hay recetas guardadas</p>
          </div>
        </div>
      </nav>

      <!-- ğŸ”¥ ELIMINADO: user-info del sidebar mÃ³vil -->
      <div class="user-info">
        <img src="assets/user.png" alt="Usuario" class="avatar">
        <div>
          <p class="username">Usuario</p>
          <p class="user-handle">@nutrichef</p>
        </div>
      </div>
    </aside>

    <!-- Overlay para cerrar menÃº mÃ³vil -->
    <div class="menu-overlay" 
         [class.active]="isMobileMenuOpen" 
         (click)="closeMobileMenu()">
    </div>

    <!-- MenÃº MÃ³vil Expandido -->
    <div class="menu-mobile-expanded" [class.active]="isMobileMenuOpen">
      <div class="menu-mobile-content">

        <!-- NavegaciÃ³n mÃ³vil -->
        <nav class="mobile-nav">
          <button class="menu-btn" 
                  routerLink="/principal" 
                  (click)="closeMobileMenu()">
            ğŸ  Inicio
          </button>
          <button class="menu-btn" 
                  routerLink="/recetas" 
                  (click)="closeMobileMenu()">
            ğŸ“– Recetas
          </button>
          <button class="menu-btn active" 
                  (click)="closeMobileMenu()">
            ğŸ’¬ Chat IA
          </button>
          <button class="menu-btn" 
                  routerLink="/analisis-imagen" 
                  (click)="closeMobileMenu()">
            ğŸ“¸ Analizar Imagen
          </button>
          <!-- ğŸ”¥ NUEVO: BotÃ³n Mi Progreso agregado al menÃº mÃ³vil -->
          <button class="menu-btn" 
                  routerLink="/progreso" 
                  (click)="closeMobileMenu()">
            ğŸ“Š Mi Progreso
          </button>
        </nav>

        <!-- Historial en versiÃ³n mÃ³vil -->
        <div class="mobile-historial">
          <h4>Historial de Recetas</h4>
          <div class="historial-list">
            <button 
              *ngFor="let item of historialRecetas" 
              class="historial-btn"
              (click)="onCargarRecetaDelHistorial(item); closeMobileMenu()">
              {{ item.receta?.nombre || 'Receta ' + item.id_receta }}
            </button>
            
            <div *ngIf="historialRecetas.length === 0" class="no-historial">
              <p>No hay recetas guardadas</p>
            </div>
          </div>
        </div>

        <!-- User info en mÃ³vil -->
        <div class="mobile-user-info">
          <img src="assets/user.png" alt="Usuario" class="avatar">
          <div class="user-details">
            <p class="username">Usuario</p>
            <p class="user-handle">@nutrichef</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Main content sin el header -->
    <main class="main-content">
      <!-- Chat Container -->
      <div class="chat-container">
        <!-- MODO RECETA COMPLETA -->
        <div *ngIf="recetaSeleccionada" class="recipe-full-view">
          <div class="recipe-full-card">
            <!-- Header -->
            <div class="recipe-full-header">
              <h2 class="recipe-full-title">{{ recetaSeleccionada.titulo }}</h2>
              <div class="recipe-full-meta">
                <span class="meta-badge">{{ recetaSeleccionada.categoria }}</span>
                <span class="meta-badge">â±ï¸ {{ recetaSeleccionada.tiempo_preparacion }} min</span>
                <span class="meta-badge">ğŸ”¥ {{ recetaSeleccionada.kcal_totales }} kcal</span>
              </div>
            </div>

            <!-- DescripciÃ³n -->
            <div class="recipe-full-description">
              <p>{{ recetaSeleccionada.descripcion }}</p>
            </div>

            <!-- Ingredientes -->
            <div class="recipe-full-section">
              <h3>ğŸ´ Ingredientes</h3>
              <div class="ingredients-grid-full">
                <div *ngFor="let ing of recetaSeleccionada.ingredientes" class="ingredient-full">
                  <span class="ingredient-name">{{ ing.nombre }}</span>
                  <span *ngIf="ing.cantidad" class="ingredient-quantity">
                    {{ ing.cantidad }} {{ ing.unidad || 'unidades' }}
                  </span>
                </div>
              </div>
            </div>

            <!-- PreparaciÃ³n -->
            <div class="recipe-full-section">
              <h3>ğŸ‘©â€ğŸ³ PreparaciÃ³n</h3>
              <ol class="steps-full">
                <li *ngFor="let paso of recetaSeleccionada.pasos" class="step-full">
                  {{ paso }}
                </li>
              </ol>
            </div>

            <!-- ExplicaciÃ³n IA -->
            <div *ngIf="recetaSeleccionada.ia_explicacion" class="ia-full">
              <h3>ğŸ¤– Por quÃ© esta receta es para ti</h3>
              <div class="ia-full-content">
                {{ recetaSeleccionada.ia_explicacion }}
              </div>
            </div>
          </div>
        </div>

        <!-- MODO CHAT NORMAL (cuando no hay receta seleccionada) -->
        <div *ngIf="!recetaSeleccionada">
          <!-- SecciÃ³n de entrada del usuario -->
          <div class="input-section">
            <h2>Â¿QuÃ© te gustarÃ­a cocinar?</h2>
            <div class="input-container">
              <input 
                type="text" 
                [(ngModel)]="userMessage" 
                placeholder="Escribe tus preferencias aquÃ­..."
                class="message-input"
                (keyup.enter)="sendMessage()">
              <button (click)="sendMessage()" class="send-btn">Generar recomendaciones</button>
            </div>
          </div>

          <!-- Loading -->
          <div *ngIf="cargando" class="loading-section">
            <div class="spinner"></div>
            <p>Generando recomendaciones personalizadas...</p>
          </div>

          <!-- Resultados de recetas -->
          <div *ngIf="opcionesRecetas.length > 0" class="recipes-section">
            <h3>Recomendaciones generadas:</h3>
            
            <div class="recipes-grid">
              <div *ngFor="let receta of opcionesRecetas" class="recipe-card">
                <!-- Header de la receta -->
                <div class="recipe-header">
                  <h4 class="recipe-title">{{ receta.titulo }}</h4>
                  <div class="recipe-meta">
                    <span class="recipe-category">{{ receta.categoria }}</span>
                    <span class="recipe-time">â±ï¸ {{ receta.tiempo_preparacion }} min</span>
                    <span class="recipe-calories">ğŸ”¥ {{ receta.kcal_totales }} kcal</span>
                  </div>
                </div>

                <!-- DescripciÃ³n -->
                <p class="recipe-description">{{ receta.descripcion }}</p>

                <!-- Ingredientes -->
                <div class="ingredients-section">
                  <h5>Ingredientes:</h5>
                  <div class="ingredients-list">
                    <span *ngFor="let ing of receta.ingredientes" class="ingredient-item">
                      â€¢ {{ ing.nombre }}  <!-- AÃ‘ADIR .nombre -->
                      <span *ngIf="ing.cantidad" class="ingredient-quantity">
                        ({{ ing.cantidad }} {{ ing.unidad || 'un' }})
                      </span>
                    </span>
                  </div>
                </div>

                <!-- Pasos de preparaciÃ³n -->
                <div class="steps-section">
                  <h5>PreparaciÃ³n:</h5>
                  <ol class="steps-list">
                    <li *ngFor="let paso of receta.pasos; let i = index" class="step-item">
                      {{ paso }}
                    </li>
                  </ol>
                </div>

                <!-- ExplicaciÃ³n de la IA -->
                <div *ngIf="receta.ia_explicacion" class="ia-explanation">
                  <div class="explanation-content">
                    {{ receta.ia_explicacion }}
                  </div>
                </div>

                <!-- BotÃ³n de acciÃ³n ACTUALIZADO -->
                <div class="recipe-actions">
                  <button 
                    class="select-recipe-btn"
                    (click)="onSeleccionarReceta(receta)">
                    ğŸ’– Prefiero esta receta
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Error -->
          <div *ngIf="errorMessage" class="error-message">
            <p>âŒ {{ errorMessage }}</p>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>